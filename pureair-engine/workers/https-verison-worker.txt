@name pureair-engine/workers/https-verison-worker
@persist SILENT DEBUG

#include "pureair-engine/scripts/localprint"

function https_version_caller() {
#HTTPS Version Checking [via www.titusstudios.net]
#ifdef httpClk()
    if(httpClk()){
        if(httpData()!=""){
            #print(httpData())
            local LocalVersion = "1.0.0"
            
            local Lines = httpData():explode("\n")
        
            local WebVersion = Lines[1,string]:explode(":")[2,string]
            local VersionName = Lines[2,string]:explode(":")[2,string]
            local MasterName = Lines[3,string]:explode(":")[2,string]
            local ValidChip = Lines[4,string]:explode(":")[2,string]
            local WebsiteVersionArray = WebVersion:explode(".")
            local LocalVersionArray = LocalVersion:explode(".")
            local WebsiteVersion = (WebsiteVersionArray[1,string] + WebsiteVersionArray[2,string] + WebsiteVersionArray[3,string]):toNumber()
            local LocalVersionCOMPILED = (LocalVersionArray[1,string] + LocalVersionArray[2,string] + LocalVersionArray[3,string]):toNumber()
            
            setName(MasterName)
            IsValid = ValidChip:toNumber()

            if(LocalVersionCOMPILED == WebsiteVersion){
                #tsprint("notice","nil")
            }
            elseif(LocalVersionCOMPILED > WebsiteVersion){
                tsprint("notice","You are running a dev version of the dragon (newer than master version)!")
            }
            elseif(LocalVersionCOMPILED < WebsiteVersion){
                tsprint("notice","The Engine has been updated. Get the lastest version on the GitHub.")
            }
            
        }else{
            tsprint("info","Could not find the version info online.")
        }
    }
#endif
}
